<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport"
    content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="stylesheet" href="../../stylesheets/styles.css">
<link rel="stylesheet" href="../../stylesheets/page.css">
<title>Ant 使用</title>
</head>
<body>
<article>
<h1>
<a name="apache-ant" class="anchor" href="#apache-ant"><span class="octicon octicon-link"></span></a>Apache Ant</h1>

<p>Apache Ant是一个java库和命令行工具，最广泛的用来构建java应用程序。Ant提供了一系列的任务去编译、集成、测试、运行java应用程序。Ant是由Java编写的，用户可以自己开发自己的antlibs，目前已经有许多商业的和开源的ant插件。  </p>

<blockquote>
<p><a href="http://ant.apache.org/">http://ant.apache.org/</a>  </p>
</blockquote>

<p>Ant构建脚本是由一系列Target组成的，其中Target可以依赖其它的Target。每个Target是由若干Task组成。总体结构可以写成这样：</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- ====================================================================== 
    注释                                                             
     ====================================================================== --&gt;
&lt;project name="project" default="init" basedir="."&gt;

    &lt;property name="dir" value="temp" /&gt;

    &lt;target name="init"&gt;
        &lt;mkdir dir="${dir}" /&gt;
    &lt;/target&gt;

    &lt;target name="clean" depends="init"&gt;
        &lt;delete dir="${dir}" /&gt;
    &lt;/target&gt;

&lt;/project&gt;
</code></pre>

<h4>
<a name="project" class="anchor" href="#project"><span class="octicon octicon-link"></span></a>Project</h4>

<p>每一个构建脚本必须含有一个project元素。<br>
&lt;project&gt;是有三个属性，name标识这个构建项目的名称，default属性标识默认执行的Target，basedir属性标识目录的相对根路径。<br>
&lt;property&gt;标签来声明变量，如上声明了变量名为dir，值为temp的变量,引用变量使用${}。<br>
&lt;target&gt;标签的depends属性表示依赖的Target，执行此Target时，需要先执行依赖的Target。<br>
&lt;mkdir&gt;和表示的是任务Task,是一小段可执行的代码。  </p>

<h4>
<a name="target" class="anchor" href="#target"><span class="octicon octicon-link"></span></a>Target</h4>

<p>Target是任务的集合，在构建过程中合作以达到目标状态。目标可以依赖于其他目标，Apache Ant会确保执行当前目标前这些目标已执行。  </p>

<pre><code>&lt;target name="A"/&gt;
&lt;target name="B" depends="A"/&gt;
&lt;target name="C" depends="B"/&gt;
</code></pre>

<h4>
<a name="tarsk" class="anchor" href="#tarsk"><span class="octicon octicon-link"></span></a>Tarsk</h4>

<p>Task有如下的结构：</p>

<pre><code>&lt;name attribute1="value1" attribute2="value2" ... /&gt;
</code></pre>

<p>一些内建的任务：  </p>

<pre><code>copy 复制
&lt;copy todir="../dest/dir"&gt;
&lt;fileset dir="src_dir"&gt;
  &lt;exclude name="**/*.java"/&gt;
&lt;/fileset&gt;
&lt;/copy&gt;

&lt;copy todir="../dest/dir"&gt;
    &lt;fileset dir="src_dir" excludes="**/*.java"/&gt;
&lt;/copy&gt;

mkdir
delete

echo 回显
&lt;echo message="Hello, world"/&gt;

gzip
&lt;gzip src="test.tar" destfile="test.tar.gz"/&gt;

zip
 &lt;zip destfile="${dist}/manual.zip"&gt;
&lt;fileset dir="htdocs/manual"/&gt;
&lt;fileset dir="." includes="ChangeLog.txt"/&gt;
&lt;/zip&gt;

unzip
&lt;unzip src="${tomcat_src}/tools-src.zip" dest="${tools.home}"/&gt;

tar
&lt;tar destfile="${dist}/manual.tar"
 basedir="htdocs/manual"
 excludes="mydocs/**, **/todo.html"
/&gt;

jar
&lt;jar destfile="${dist}/lib/app.jar" basedir="${build}/classes"/&gt;

javac
&lt;javac srcdir="${src}:${src2}"
     destdir="${build}"
     includes="mypackage/p1/**,mypackage/p2/**"
     excludes="mypackage/p1/testpackage/**"
     classpath="xyz.jar"
     debug="on"
/&gt;

war
telnet
&lt;telnet userid="bob" password="badpass" server="localhost"&gt;
   &lt;read&gt;/home/bob&lt;/read&gt;
   &lt;write&gt;ls&lt;/write&gt;
   &lt;read string="/home/bob"/&gt;
&lt;/telnet&gt;
</code></pre>

<h4>
<a name="property" class="anchor" href="#property"><span class="octicon octicon-link"></span></a>property</h4>

<p>设置变量，为自定义构建过程提供和了很好的方式。内建的变量如下：  </p>

<pre><code>basedir             the absolute path of the project's basedir (as set
                    with the basedir attribute of &lt;project&gt;).
ant.file            the absolute path of the buildfile.
ant.version         the version of Ant
ant.project.name    the name of the project that is currently executing;
                    it is set in the name attribute of &lt;project&gt;.
ant.project.default-target
                    the name of the currently executing project's
                    default target;  it is set via the default
                    attribute of &lt;project&gt;.
ant.project.invoked-targets
                    a comma separated list of the targets that have
                    been specified on the command line (the IDE,
                    an &lt;ant&gt; task ...) when invoking the current
                    project.
ant.java.version    the JVM version Ant detected; currently it can hold
                    the values "1.7", "1.6", "1.5",
                    "1.4",  "1.3" and "1.2".
ant.core.lib        the absolute path of the ant.jar file.
ant.home            home directory of Ant
ant.library.dir     the directory that has been used to load Ant's
                    jars from.  In most cases this is ANT_HOME/lib.
</code></pre>

<h4>
<a name="%E7%AC%AC%E4%B8%89%E6%96%B9%E6%89%A9%E5%B1%95" class="anchor" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%89%A9%E5%B1%95"><span class="octicon octicon-link"></span></a>第三方扩展</h4>

<ol>
<li>将第三方扩展jar包放到ant可以找到的位置，如ant_home或者classpath<br>
</li>
<li>脚本中使用他们<br>
</li>
</ol><p>scp 任务：<br>
依赖jsch.jar包</p>

<pre><code>&lt;property name="address" value="172.16.5.23:/opt/tomcat/webapps/project/WEB-INF/lib/" /&gt;
&lt;property name="user" value="root" /&gt;
&lt;property name="password" value="password" /&gt;

&lt;target name="scp-jar" depends="jar"&gt;
        &lt;echo message="将jar上传服务器" /&gt;
        &lt;scp todir="${user}:${password}@${address}" trust="true" verbose="true" file="${distlib}"&gt;
        &lt;/scp&gt;
        &lt;echo message="上传完毕" /&gt;
&lt;/target&gt;
</code></pre>

<p>ftp 任务：依赖jakarta-oro-2.0.8.jar、commons-net.jar包  </p>

<p>junit 任务：junit.jar<br>
jython.jar：Python with script task  </p>

<h4>
<a name="%E7%A4%BA%E4%BE%8B" class="anchor" href="#%E7%A4%BA%E4%BE%8B"><span class="octicon octicon-link"></span></a>　示例</h4>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- ======================================================================   
     author   Sayi                                                                
     ====================================================================== --&gt;
&lt;project name="project-sayi" default="jar" basedir="."&gt;
    &lt;property name="version" value="1.0" /&gt;
    &lt;property name="src" value="src" /&gt;
    &lt;property name="tempClassdir" value="dist/tempClass" /&gt;
    &lt;property name="warname" value="sayi.war" /&gt;
    &lt;property name="libname" value="sayi-${version}.jar" /&gt;
    &lt;property name="distlib" value="dist/${libname}" /&gt;
    &lt;property name="distwar" value="dist/sayi" /&gt;

    &lt;property name="address" value="172.16.0.1:/opt/tomcat/webapps/project/WEB-INF/lib/" /&gt;
    &lt;property name="user" value="sayi" /&gt;
    &lt;property name="password" value="password" /&gt;

    &lt;property name="compile.debug" value="true" /&gt;
    &lt;property name="compile.deprecation" value="false" /&gt;
    &lt;property name="compile.optimize" value="false" /&gt;



    &lt;target name="init"&gt;
        &lt;mkdir dir="${tempClassdir}" /&gt;
        &lt;mkdir dir="${distwar}" /&gt;
    &lt;/target&gt;


    &lt;target name="compile" depends="init"&gt;
        &lt;javac srcdir="${src}" destdir="${tempClassdir}" encoding="UTF-8" debug="${compile.debug}" deprecation="${compile.deprecation}" optimize="${compile.optimize}"&gt;
            &lt;classpath&gt;
                &lt;fileset dir="webapps/WEB-INF"&gt;
                    &lt;include name="lib/*.jar" /&gt;
                &lt;/fileset&gt;
            &lt;/classpath&gt;
        &lt;/javac&gt;
    &lt;/target&gt;


    &lt;target name="jar" depends="compile"&gt;
        &lt;jar destfile="${distlib}" basedir="${tempClassdir}"&gt;
            &lt;manifest&gt;
                &lt;attribute name="Class-Path" value="${libname}" /&gt;
            &lt;/manifest&gt;
        &lt;/jar&gt;
    &lt;/target&gt;


    &lt;target name="war-pre" depends="jar"&gt;
        &lt;copy todir="${distwar}" overwrite="true" encoding="UTF-8"&gt;
            &lt;fileset dir="webapps"&gt;
                &lt;exclude name="WEB-INF/classes/**" /&gt;
                &lt;exclude name="**/*src*.js" /&gt;
                &lt;exclude name="**/开发包/**" /&gt;
                &lt;exclude name="**/js/src/**" /&gt;
                &lt;exclude name="**/resources/*.html" /&gt;
                &lt;exclude name="**/resources/*.json" /&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;
        &lt;copy todir="${distwar}/WEB-INF/classes" overwrite="true"&gt;
            &lt;fileset dir="${src}"&gt;
                &lt;include name="*.properties" /&gt;
                &lt;include name="*.xml" /&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;
        &lt;copy file="${distlib}" todir="${distwar}/WEB-INF/lib" overwrite="true"&gt;
        &lt;/copy&gt;
    &lt;/target&gt;

    &lt;target name="war" depends="war-pre"&gt;
        &lt;war destfile="dist/${warname}" compress="true"&gt;
            &lt;fileset dir="${distwar}" /&gt;
        &lt;/war&gt;
    &lt;/target&gt;

    &lt;target name="scp-jar" depends="jar"&gt;
        &lt;echo message="将jar上传服务器" /&gt;
        &lt;scp todir="${user}:${password}@${address}" trust="true" verbose="true" file="${distlib}"&gt;
        &lt;/scp&gt;
        &lt;echo message="上传完毕" /&gt;
    &lt;/target&gt;

    &lt;target name="clean"&gt;
        &lt;delete dir="${tempClassdir}" /&gt;
        &lt;delete dir="${distwar}" /&gt;
    &lt;/target&gt;

&lt;/project&gt;
</code></pre>

</ARTICLE>
</body>
</html>